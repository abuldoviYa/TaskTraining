
let tasks = [];
// let tasks = [{"id":"f198b81b-f2eb-49d4-8c29-21e578ab3a33","name":"Morbipraesent","shortDesc":"Montes felis lectusnec nullalacus vitaesed neque vulputatenon vitaemorbi maurisleo lacus nullam tristique.","fullDesc":"Montes felis lectusnec nullalacus vitaesed neque vulputatenon vitaemorbi maurisleo lacus nullam tristique. Cursuselit viverradolor condimentum donec auguemus vestibulumrhoncus malesuadaat ac elementumetiam rhoncus maecenas faucibusmagna gravidaultrices nisiin quisnulla seda nuncut mattis maurisnulla tristiquepellentesque mifringilla tristiquepellentesque suscipit sedid. Auguemus ultricesvel porttitortristique tempus elitmassa lectusnec ultricesturpis volutpatvolutpat atsed nullamvenenatis etiama viverravel suscipit mifringilla nam commodo posueredolor commodo pharetrapharetra ac magnis.","date":"2021-11-22T19:30:00.000+0000","status":false},{"id":"54ea2633-0004-49bc-a091-568d9145a47b","name":"Nislsed purusmattis","shortDesc":"Etiam nonpellentesque euismodpellentesque ornarelectus habitantid lectusnec portacursus idvitae telluslobortis quiseu nascetur.","fullDesc":"Etiam nonpellentesque euismodpellentesque ornarelectus habitantid lectusnec portacursus idvitae telluslobortis quiseu nascetur. Elitmassa maecenas maecenas loremlobortis nuncut neque mattisut nibhfaucibus lacuspretium duisviverra quisque nibhodio facilisi viverraid elementum viverraeu ullamcorper auctor quisamet ultricesvel quis ametleo in integerduis pulvinarsed vel feugiat quam eros.","date":"2021-11-22T10:00:00.000+0000","status":true},{"id":"6e265dce-24b6-4b66-a2a3-a6243fb92a18","name":"Elit ullamcorperamet","shortDesc":"Atultricies cursus loremconsectetur conguehendrerit molestie idsed lacuspretium maurisut purusmattis suspendisseet.","fullDesc":"Atultricies cursus loremconsectetur conguehendrerit molestie idsed lacuspretium maurisut purusmattis suspendisseet. Elitut vel ametenim adipiscingfeugiat ultricesodio sedpurus mattis vitaesed non purusvenenatis potenti integerdignissim tincidunt vehicula sedpurus nunc suscipit eget lectusnec infaucibus morbipraesent eiusmod mattisut ullamcorperamet lobortiscursus proin nascetur viverrapharetra. Egetenim nunc aviverra egestas sagittisornare congue vitaesit porttitortristique purusvenenatis eros libero vitaerutrum aliquet maurisut mattisut eumassa potentiid ornare fusce penatibus portacursus tempor adiam incididunt. Sedcurabitur posueredolor rhoncus adipiscingnisi tempor magnis idvitae amet leoeu volutpatvolutpat rutrum dui vitaenunc vitaemorbi molestieultrices sollicitudin condimentum purussem nibhpretium conguemassa convallispharetra venenatistempor antemi athendrerit consectetur metus.","date":"2021-11-22T02:00:00.000+0000","status":false},{"id":"d4a96737-8c15-4f86-8471-f723df618379","name":"Habitasse","shortDesc":"Nullaconvallis sapienat maecenasdui habitasse quisnulla atultricies ametsed egetenim arcugravida vitaemorbi felisnisl ornaresit acvitae rhoncus integerduis tempusegestas risuseget aliquet dis magnis sapienat.","fullDesc":"Nullaconvallis sapienat maecenasdui habitasse quisnulla atultricies ametsed egetenim arcugravida vitaemorbi felisnisl ornaresit acvitae rhoncus integerduis tempusegestas risuseget aliquet dis magnis sapienat. Nequequam ultricesturpis parturient atpretium convallispharetra at semper maurisiaculis diamproin euismodpellentesque aliquamvolutpat nislsed arcuviverra. Penatibus malesuadaat tellusvitae magniscursus ullamcorperviverra quislaoreet nullam ultricesenim sempurus nibhadipiscing tempus ametenim molestie portacursus laoreet leo etnullam porttitorsuspendisse. Vel morbi dapibus sedporta ultriciesaenean nam famesmalesuada vivamus loremconsectetur maecenasdui faucibusmi sitfacilisis ametnunc namarcu nonsemper potenti egetodio vitaerutrum condimentum vitaesed ipsumpellentesque.","date":"2021-11-22T02:30:00.000+0000","status":false},{"id":"a88990a4-901c-4c80-9f19-900da78c48bd","name":"Ultrices","shortDesc":"Quisque nam dictumst augueinterdum purusvenenatis phasellus donec quisurna volutpatvolutpat leovitae rutrum.","fullDesc":"Quisque nam dictumst augueinterdum purusvenenatis phasellus donec quisurna volutpatvolutpat leovitae rutrum. Blanditdictum maecenasdui feugiat vitaerutrum bibendum purus eiusmod fringilla cursusamet fermentum at augue felis cras sagittissem malesuada.","date":"2021-11-22T22:00:00.000+0000","status":true},{"id":"f2853e35-073f-4f43-8ae4-51151efa0dfc","name":"Sedcurabitur pellentesqueeget","shortDesc":"Ornare ornareridiculus gravida nullasem sedurna sodaleshendrerit purussem aenean molestiediam ridiculus utat mi etiamadipiscing maurisleo liberonam laciniaerat aliquamdonec aliquet consequat vitaesollicitudin phasellusmaecenas.","fullDesc":"Ornare ornareridiculus gravida nullasem sedurna sodaleshendrerit purussem aenean molestiediam ridiculus utat mi etiamadipiscing maurisleo liberonam laciniaerat aliquamdonec aliquet consequat vitaesollicitudin phasellusmaecenas. Maurisleo proin eumassa ametsed suscipitlorem habitantid maecenaselementum libero risusdolor adipiscing vestibulum.","date":"2021-11-22T08:00:00.000+0000","status":false},{"id":"d4418616-d068-429c-8535-59bc3beb2804","name":"Montes","shortDesc":"Duis pharetra elit duis viverrapharetra commodo nonsed arcu acsed ultricesturpis mi.","fullDesc":"Duis pharetra elit duis viverrapharetra commodo nonsed arcu acsed ultricesturpis mi. Dignissim eros ipsumpellentesque antemi ligula congue facilisi tempormorbi sodaleshendrerit venenatiseu lectusnulla quisamet egetet dignissimnunc faucibusduis cursusamet elementum lobortisipsum idmi integerid felissollicitudin adipiscingfeugiat morbivelit interdumamet massaat tempuspellentesque massa netusmattis.","date":"2021-11-23T16:30:00.000+0000","status":true}];

function filterTasks(tasksToFilter) {
    const incompleteCheckbox = document.getElementById('incompleteTasksCheckbox');
    const filteredTasks = incompleteCheckbox.checked
        ? tasksToFilter.filter(task => !task.status) // Show only incomplete tasks
        : tasksToFilter; // Show all tasks

    return filteredTasks;
}

async function fetchTasks(url, queryParams = {}) {
    try {
        const queryString = Object.keys(queryParams)
            .map(key => `${key}=${queryParams[key]}`)
            .join('&');

        const javaServerUrl = `http://localhost:8080/${url}?${queryString}`;
        const response = await fetch(javaServerUrl);

        if (!response.ok) {
            throw new Error(`Error: ${response.statusText}`);
        }

        tasks = await response.json();
        return tasks;
    } catch (error) {
        console.error(error);
    }
}

function createTaskElement(task) {
    const taskElement = document.createElement('div');
    taskElement.classList.add("listItem")
    taskElement.innerHTML = `
            <h3>${task.name}</h3>
            <p>Date: ${task.date}</p>
            <p>Status: ${task.status ? 'Completed' : 'Incomplete'}</p>
            <p>${task.shortDesc}</p>
            <button onclick="openTaskModal('${task.id}')">Open Description</button>
        `;
    return taskElement;
}

async function displayTasks() {
    try {
        if (tasks.length === 0) {
            tasks = await fetchTasks('https://todo.doczilla.pro/api/todos');
        }
        const taskListContainer = document.getElementById('taskList');
        taskListContainer.innerHTML = '';

        const filteredTasks = filterTasks(tasks);

        if (filteredTasks.length === 0) {
            taskListContainer.innerHTML = '<p>No tasks found.</p>';
            return;
        }

        filteredTasks.forEach(task => {
            const taskElement = createTaskElement(task);
            taskListContainer.appendChild(taskElement);
        });
    } catch (error) {
        console.error(error);
    }
}

function openTaskModal(taskId) {
    const task = tasks.find(t => t.id === taskId);
    const modalContent = document.getElementById('modalContent');
    modalContent.innerHTML = `
            <h2>${task.name}</h2>
            <p>Date: ${task.date}</p>
            <p>Status: ${task.status ? 'Completed' : 'Incomplete'}</p>
            <p>${task.fullDesc}</p>
        `;

    const taskModal = document.getElementById('taskModal');
    const overlay = document.getElementById('overlay');
    taskModal.style.display = 'block';
    overlay.style.display = 'block';

    document.body.classList.add('modal-open');
}

// Function to close task modal
function closeTaskModal() {
    const overlay = document.getElementById('overlay');
    const taskModal = document.getElementById('taskModal');
    taskModal.style.display = 'none';
    overlay.style.display = 'none';

    document.body.classList.remove('modal-open');
}

$('#dateRange').datepicker({
    showOtherMonths: true,
    selectOtherMonths: true,
    dateFormat: 'yy-mm-dd',
    onSelect: function (dateText, inst) {
        const selectedDate = $(this).datepicker('getDate');
        $('#calendar').datepicker('setDate', selectedDate);
        updateTasks(selectedDate);
    }
});

$('#calendar').datepicker({
    showOtherMonths: true,
    selectOtherMonths: true,
    beforeShowDay: function (date) {
        const startDate = $('#dateRange').datepicker('getDate');
        const endDate = $('#calendar').datepicker('getDate');

        if (startDate && endDate && date >= startDate && date <= endDate) {
            return [true, 'ui-state-highlight'];
        }

        return [true, ''];
    },
    onSelect: function (dateText, inst) {
        const startDate = $('#dateRange').datepicker('getDate');
        const endDate = $('#calendar').datepicker('getDate');


        if (!startDate || endDate < startDate) {
            $('#dateRange').datepicker('setDate', endDate);
        } else {
            $('#dateRange').datepicker('setDate', startDate);
        }

        updateTasks(startDate, endDate);
    }
});

function updateTasks(startDate, endDate) {
    startDate = startDate.getTime()
    endDate = endDate.getTime()
    if(startDate == null) {
        startDate = endDate
    }
    const apiUrl = 'https://todo.doczilla.pro/api/todos/date';
    const queryParams = {
        from: startDate,
        to: endDate,

    };

    fetchTasks(apiUrl, queryParams)
}

$('#search-icon').on('click', function () {
    const searchQuery = $('#taskSearch').val();
    searchTasks(searchQuery); // Search tasks based on the entered query
});

async function searchTasks(query) {
    // Make a request to the API with the search query
    const apiUrl = 'https://todo.doczilla.pro/api/todos/find';
    const queryParams = {
        q: query,
    };

    tasks = await fetchTasks(apiUrl, queryParams)
    displayTasks();
}

displayTasks();

document.getElementById('incompleteTasksCheckbox').addEventListener('change', displayTasks);
